<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="generator" content="Zim 0.76.1">
    <meta name="description" content="Personal website for my programming, computing and finance hobbies"> 
    <meta name="keywords" content="karl, hunter, go, programming, computing, finance, personal, hobby, defiant-fg, defiant"> 
    <meta name="Zim template" content="HGE Bootstrap responsive template" />
    <meta name="template author" content="Hugo Gaibor E.">
    <meta name="Author" content="Karl Hunter">
    <link rel="icon" href="../../../_resources/images/favicon.ico">

    <title>Wednesday 19 Mar 2025</title>

    <!-- JS Jquery and Bootstrap scripts -->
    <script type='text/javascript' src="https://karlhunter.co.uk/res/js/jquery-3.6.0.min.js" type="text/javascript"></script>
    <script src="https://karlhunter.co.uk/res/js/bootstrap.min.js"></script>

    <!-- Bootstrap core CSS -->
      <link href="https://karlhunter.co.uk/res/css/bootstrap.css" rel="stylesheet" />

    <!-- highlight module
         Syntax highlinting libraries 
         Taken from https://highlightjs.org/ 
         https://github.com/highlightjs/highlight.js
         You can change higlight code box style by choosing a different css style below, 
         all styles were included for ease of customization
      -->
      <link rel="stylesheet" href="https://karlhunter.co.uk/res/highlight/styles/base16/github.min.css">
      <script src="https://karlhunter.co.uk/res/highlight/highlight.min.js"></script>

    <!-- HGE styles and JS functions for this template -->
      <link href="https://karlhunter.co.uk/res/css/hge-bootstrap_common.css" rel="stylesheet">
      <script src="https://karlhunter.co.uk/res/js/hge-bootstrap_common.js"></script>
      <script src="https://karlhunter.co.uk/res/js/hge-bootstrap_multi-page.js"></script>
  </head>

  <body>
    <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-1 justify-content upper-nav-bar">
      <div class="btn-toolbar" role="toolbar" aria-label="Button groups">
        <div class="btn-group mr-2" role="group" aria-label="First group">
          <span class="text-white">
            <img id="toggleSideMenu" class="pt-0 p-0 px-0 btn" src="https://karlhunter.co.uk/res/images/menu.svg" height="22" alt="Menu">
          </span>
        </div>
      </div>
      <div class="btn-toolbar" role="toolbar" aria-label="Button groups">
        <div class="btn-group mr-2" role="group" aria-label="Navigation group">
              <button type="button" class="btn btn-info btn-xs" role="button" onclick="location.href='../03.html'">Prev</button>
  
              <button type="button" class="btn btn-info btn-xs" role="button" onclick="location.href='../../../map.html'">Index</button>

              <button type="button" class="btn btn-info btn-xs" role="button" onclick="location.href='../../Index.html'">Next</button>
        </div>
      </div>
      <div>
        <div class="btn-group mr-2" role="group" aria-label="Fifth group">
          <button class="btn btn-warning btn-xs" id="scrollUp" onclick="scrollToTop();" style="display: none;"><span style="font-weight: 500;">Scroll Up</span></button>
        </div>
        <div class="btn-group mr-2" role="group" aria-label="Fifth group">
          <button class="btn btn-success btn-xs pt-0 p-0 px-0" id="printMe" >
              <img id="printImg"  class="pt-0 p-0 px-1" style="padding:2px;" onclick="window.print();" src="https://karlhunter.co.uk/res/images/printer.svg" alt="Print">
          </button>
        </div>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
          <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar d-print-none" id="sidebarMenuNav" style="padding-top: 40px;">
          <div id="sidebarMenu">
            <ul>
<li><a href="../../../About.html" title="About" class="page">About</a></li>
<li><a href="../../../Buy_Me_Coffee.html" title="Buy Me Coffee" class="page">Buy Me Coffee</a></li>
<li><a href="../../../Computing.html" title="Computing" class="page">Computing</a></li>
<li><a href="../../../Contact.html" title="Contact" class="page">Contact</a></li>
<li><a href="../../../index.html" title="index" class="page">index</a></li>
<li><a href="../../../Journal.html" title="Journal" class="page">Journal</a>
<ul>
<li><a href="../../2022.html" title="2022" class="page">2022</a></li>
<li><a href="../../2023.html" title="2023" class="page">2023</a></li>
<li><a href="../../2024.html" title="2024" class="page">2024</a></li>
<li><a href="../../2025.html" title="2025" class="page">2025</a>
<ul>
<li><a href="../02.html" title="02" class="page">02</a></li>
<li><a href="../03.html" title="03" class="page">03</a>
<ul>
<li><b>19</b></li>
</ul></li>
</ul></li>
<li><a href="../../Index.html" title="Index" class="page">Index</a></li>
</ul></li>
<li><a href="../../../Money.html" title="Money" class="page">Money</a></li>
<li><a href="../../../Projects.html" title="Projects" class="page">Projects</a></li>
</ul>

          </div>
        </nav>

        <main role="main" class="col-md-9 col-lg-10 ml-sm-auto pt-3 px-4" id="pageContents">
            <noscript>
              <div style="padding: 10px">
                <span style="color:#D48D8D">
                <p>Javascript is not enabled</p>
                <p>Most features won't</p>
                <p>work correctly</p>
                <p>Please enable javascript</p></span>
              </div>
            </noscript>

                <h1>Wednesday 19 Mar 2025<a name='Wednesday 19 Mar 2025_1_1' class="offset-anchor"></a></h1>
              
                <h2>ZFS Pool Storage Upgrade<a name='ZFS Pool Storage Upgrade_1_2' class="offset-anchor"></a></h2>
              <p>
It's ZFS storage upgrade time! I am currently running two 4 TB hard drives, and one 2 TB hard drive in a RAIDZ1, which means my usable space is 5.45T. My pool has reached 86% capacity. You should not let ZFS get over 80% full due to performance downgrades. Let's upgrade.
</p>

<p>
I acquired another 4 TB enterprise hard drive from eBay for Â£50; this drive will replace the 2 TB hard drive. I used to have both WD and Seagate drives, but noticed I can get Toshiba enterprise drives at a good price second hand. I have four Toshiba drives (prior to getting this new one), with two in my back up server, one in my NAS and the one as an off-site backup.
</p>


                <h5>Things to note:<a name='Things to note:_1_3' class="offset-anchor"></a></h5>
              <ul>
<li>Always use the replace command to maintain redundancy should a drive fail during a resilver</li>
<li>Think about the command before entering it</li>
<li>Check you have the "autoexpand" option on in your pool, so that ZFS will reclaim space</li>
</ul>

<p>
I inserted the new drive into a space slot, booted the backup server. Here's the state before the upgrade:
</p>

                <h3>=<a name='=_1_4' class="offset-anchor"></a></h3>
              <p>
<tt>zpool status</tt>
</p>

<pre>
NAME    SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
rpool  5.45T  4.71T   760G     889M         -     0%    86%  1.00x    ONLINE  -
</pre>


                <h3>Resilver in progress<a name='Resilver in progress_1_5' class="offset-anchor"></a></h3>
              <pre>
  pool: rpool
 state: ONLINE
status: One or more devices is currently being resilvered.  The pool will
	continue to function, possibly in a degraded state.
action: Wait for the resilver to complete.
  scan: resilver in progress since Wed Mar 19 07:56:32 2025
	2.29T scanned at 2.96G/s, 206G issued at 266M/s, 4.71T total
	68.5G resilvered, 4.27% done, 04:55:45 to go
config:

	NAME                                              STATE     READ WRITE CKSUM
	rpool                                             ONLINE       0     0     0
	  raidz1-0                                        ONLINE       0     0     0
	    ata-TOSHIBA_MG04ACA400E_XXXXXXXXXXXX          ONLINE       0     0     0
	    ata-TOSHIBA_MG04ACA400N_XXXXXXXXXXXX          ONLINE       0     0     0
	    replacing-2                                   ONLINE       0     0     0
	      ata-WDC_WD2002FFSX-XXXXXXXXXXXXXXXXXXXXXXX  ONLINE       0     0     0
	      ata-TOSHIBA_MG08ADA400E_XXXXXXXXXXXX        ONLINE       0     0     0  (resilvering)

errors: No known data errors
</pre>



                <h4>Command to resilver<a name='Command to resilver_1_6' class="offset-anchor"></a></h4>
              <p>
<tt>zpool replace rpool ata-WDC_WD2002FFSX-XXXXXXXXXXXXXXXXXXXXXXX /dev/disk/by-id/ata-TOSHIBA_MG08ADA400E_XXXXXXXXXXXX</tt>
</p>



                <h3>Following Resilver<a name='Following Resilver_1_7' class="offset-anchor"></a></h3>
              <p>
Great, everything went well and I have now more capacity. 
</p>

<pre>
NAME    SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
rpool  10.9T  4.71T  6.20T        -         -     0%    43%  1.00x    ONLINE  -
</pre>


<pre>
  pool: rpool
 state: ONLINE
  scan: resilvered 1.58T in 03:30:28 with 0 errors on Wed Mar 19 11:27:00 2025
config:

	NAME                                            STATE     READ WRITE CKSUM
	rpool                                           ONLINE       0     0     0
	  raidz1-0                                      ONLINE       0     0     0
	    ata-TOSHIBA_MG04ACA400E_XXXXXXXXXXXX        ONLINE       0     0     0
	    ata-TOSHIBA_MG04ACA400N_XXXXXXXXXXXX        ONLINE       0     0     0
	    ata-TOSHIBA_MG08ADA400E_XXXXXXXXXXXX        ONLINE       0     0     0

errors: No known data errors
</pre>


                <h3>Conclusion<a name='Conclusion_1_8' class="offset-anchor"></a></h3>
              <p>
It is easy to replace a hard drive in a ZFS pool to increase capacity. I now have 10T to play with, at 43% capacity now. I will write back when a drive fails - let's hope it's not soon.
</p>

            
            <span class="backlinks">
                <hr class='footnotes'>
                <b>Backlinks:</b>
                <br />
                <a href='../../../index.html'>index</a>
                
<br />
                <a href='../../Index.html'>Journal:Index</a>
                
<br />
                <a href='../03.html'>Journal:2025:03</a>
                
            </span>

            

        </main>
      </div>
    </div>
  </body>
</html>
