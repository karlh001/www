<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="generator" content="Zim 0.75.2">
    <meta name="Zim template" content="HGE Bootstrap responsive template" />
    <meta name="template author" content="Hugo Gaibor E.">
    <link rel="icon" href="../../../_resources/images/favicon.ico">

    <title>Tuesday 03 Jan 2023</title>

    <!-- JS Jquery and Bootstrap scripts -->
    <script type='text/javascript' src="https://karlhunter.co.uk/res/js/jquery-3.6.0.min.js" type="text/javascript"></script>
    <script src="https://karlhunter.co.uk/res/js/bootstrap.min.js"></script>

    <!-- Bootstrap core CSS -->
      <link href="https://karlhunter.co.uk/res/css/bootstrap.css" rel="stylesheet" />

    <!-- highlight module
         Syntax highlinting libraries 
         Taken from https://highlightjs.org/ 
         https://github.com/highlightjs/highlight.js
         You can change higlight code box style by choosing a different css style below, 
         all styles were included for ease of customization
      -->
      <link rel="stylesheet" href="https://karlhunter.co.uk/res/highlight/styles/base16/github.min.css">
      <script src="https://karlhunter.co.uk/res/highlight/highlight.min.js"></script>

    <!-- HGE styles and JS functions for this template -->
      <link href="https://karlhunter.co.uk/res/css/hge-bootstrap_common.css" rel="stylesheet">
      <script src="https://karlhunter.co.uk/res/js/hge-bootstrap_common.js"></script>
      <script src="https://karlhunter.co.uk/res/js/hge-bootstrap_multi-page.js"></script>
  </head>

  <body>
    <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-1 justify-content upper-nav-bar">
      <div class="btn-toolbar" role="toolbar" aria-label="Button groups">
        <div class="btn-group mr-2" role="group" aria-label="First group">
          <span class="text-white">
            <img id="toggleSideMenu" class="pt-0 p-0 px-0 btn" src="https://karlhunter.co.uk/res/images/menu.svg" height="22" alt="Menu">
          </span>
        </div>
      </div>
      <div class="btn-toolbar" role="toolbar" aria-label="Button groups">
        <div class="btn-group mr-2" role="group" aria-label="Navigation group">
              <button type="button" class="btn btn-info btn-xs" role="button" onclick="location.href='./01.html'">Prev</button>
  
              <button type="button" class="btn btn-info btn-xs" role="button" onclick="location.href='../../../map.html'">Index</button>

              <button type="button" class="btn btn-info btn-xs" role="button" onclick="location.href='./09.html'">Next</button>
        </div>
      </div>
      <div>
        <div class="btn-group mr-2" role="group" aria-label="Fifth group">
          <button class="btn btn-warning btn-xs" id="scrollUp" onclick="scrollToTop();" style="display: none;"><span style="font-weight: 500;">Scroll Up</span></button>
        </div>
        <div class="btn-group mr-2" role="group" aria-label="Fifth group">
          <button class="btn btn-success btn-xs pt-0 p-0 px-0" id="printMe" >
              <img id="printImg"  class="pt-0 p-0 px-1" style="padding:2px;" onclick="window.print();" src="https://karlhunter.co.uk/res/images/printer.svg" alt="Print">
          </button>
        </div>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
          <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar d-print-none" id="sidebarMenuNav" style="padding-top: 40px;">
          <div id="sidebarMenu">
            <ul>
<li><a href="../../../About.html" title="About" class="page">About</a></li>
<li><a href="../../../Buy_Me_Coffee.html" title="Buy Me Coffee" class="page">Buy Me Coffee</a></li>
<li><a href="../../../Computing.html" title="Computing" class="page">Computing</a></li>
<li><a href="../../../Contact.html" title="Contact" class="page">Contact</a></li>
<li><a href="../../../Home.html" title="Home" class="page">Home</a></li>
<li><a href="../../../Journal.html" title="Journal" class="page">Journal</a>
<ul>
<li><a href="../../2022.html" title="2022" class="page">2022</a></li>
<li><a href="../../2023.html" title="2023" class="page">2023</a>
<ul>
<li><a href="../01.html" title="01" class="page">01</a>
<ul>
<li><a href="./01.html" title="01" class="page">01</a></li>
<li><b>03</b></li>
<li><a href="./09.html" title="09" class="page">09</a></li>
<li><a href="./11.html" title="11" class="page">11</a></li>
<li><a href="./13.html" title="13" class="page">13</a></li>
<li><a href="./21.html" title="21" class="page">21</a></li>
<li><a href="./30.html" title="30" class="page">30</a></li>
</ul></li>
<li><a href="../02.html" title="02" class="page">02</a></li>
<li><a href="../03.html" title="03" class="page">03</a></li>
<li><a href="../04.html" title="04" class="page">04</a></li>
<li><a href="../07.html" title="07" class="page">07</a></li>
<li><a href="../08.html" title="08" class="page">08</a></li>
<li><a href="../09.html" title="09" class="page">09</a></li>
<li><a href="../10.html" title="10" class="page">10</a></li>
<li><a href="../11.html" title="11" class="page">11</a></li>
<li><a href="../12.html" title="12" class="page">12</a></li>
</ul></li>
<li><a href="../../2024.html" title="2024" class="page">2024</a></li>
<li><a href="../../Index.html" title="Index" class="page">Index</a></li>
</ul></li>
<li><a href="../../../Money.html" title="Money" class="page">Money</a></li>
<li><a href="../../../Projects.html" title="Projects" class="page">Projects</a></li>
</ul>

          </div>
        </nav>

        <main role="main" class="col-md-9 col-lg-10 ml-sm-auto pt-3 px-4" id="pageContents">
            <noscript>
              <div style="padding: 10px">
                <span style="color:#D48D8D">
                <p>Javascript is not enabled</p>
                <p>Most features won't</p>
                <p>work correctly</p>
                <p>Please enable javascript</p></span>
              </div>
            </noscript>

                <h1>Tuesday 03 Jan 2023<a name='Tuesday 03 Jan 2023_1_1' class="offset-anchor"></a></h1>
              
<hr>


                <h1>ZFS<a name='ZFS_1_2' class="offset-anchor"></a></h1>
              <p>
<img src="./03/openzfs.png">
</p>

<p>
To maintain a secure long-term back-up I use <a href="https://en.wikipedia.org/wiki/ZFS" title="ZFS" class="https">ZFS</a> - it's a file system run from FreeBSD or Linux to manage files. I am running OpenZFS on Ubuntu server. 
</p>


                <h2>Copy-on-write<a name='Copy-on-write_1_3' class="offset-anchor"></a></h2>
              <p>
An important feature of the file system is copy-on-write. This means that if I create a new version of the file, the orginal will remain in place (provided you have set-up regular snapshots).
</p>


                <h2>Snapshots<a name='Snapshots_1_4' class="offset-anchor"></a></h2>
              <p>
I create regular snapshots of my data sets to return accidently deleted files. This simple command suffices:
</p>

<p>
<tt>zfs snapshot pool/dataset@today</tt>
</p>

<p>
Creating snapshots will not use additional disk space, but if you delete a file that is within a snapshot, then the space will not be reallocated. 
</p>


                <h2>Integrity checks (scrub)<a name='Integrity checks (scrub)_1_5' class="offset-anchor"></a></h2>
              <p>
Essential feature to prevent <a href="https://en.wikipedia.org/wiki/Data_degradation" title="bitrot" class="https">bitrot</a>. The scrub program will test every block's hash to ensure the file has not been changed. If there is corruption, then ZFS will restore the block from a redundant hard drive if you are running in a pool. It is recommended to run ZFS on at least two hard drives. 
</p>

<p>
<tt>zpool scrub pool</tt>
</p>

<p>
<i>Where pool is the name of your pool</i>
</p>


                <h2>Encryption<a name='Encryption_1_6' class="offset-anchor"></a></h2>
              <p>
ZFS allows you to encrypt datasets. This is encryption at rest, so if the device is stolen your data would not be accessible. I use encryption with a passhrase, however ZFS can be configured to auto mount. 
</p>


                <h2>Redundancy / Pooled Storage<a name='Redundancy / Pooled Storage_1_7' class="offset-anchor"></a></h2>
              <p>
To prevent loss of data from a hard drive failure, you can set-up pools to span multiple disk. I use ZFS in mirror, which means I have two hard drive <i>mirrored</i> the same. You can add additional drives to expand the pool. However, once you add drives to create new VDEVs, you cann go back. For example, I run two hard drives pool together in one VDEV. If I wanted more storage, to protect data, I would need to add two hard drives and create a new VDEV.  I created the pool by using this command:
</p>

<p>
<tt>zpool create pool mirror /dev/disk/by-id/xyz /dev/disk/by-id/abc</tt>
</p>


<p>
<img src="./03/pasted_image.png">
</p>


                <h2>How I use ZFS<a name='How I use ZFS_1_8' class="offset-anchor"></a></h2>
              <p>
All my data from all devices are backed up to my network attached storage computer. This forms a long-term backup. The computer is attached to a battery backup with surge protection, and unplugged when not in use. It's turned on weekly or more often to run my backup scripts.
</p>

<p>
Everytime the backup script is run, a snapshot is created of each dataset. 
</p>

<p>
Every 2 weeks, I will run the scrub command to check for corruption. 
</p>

<p>
I do not trust one device, so the pool is backed up to 2 external hard drives on a rotation. In addition, important data such as pictures and documents are stored in <a href="../../../Computing/Backup/AWS_S3.html" title="the cloud" class="page">the cloud</a>.
</p>

<p>
I monitor ZFS using the status page and list (to check dataset size usage)
</p>

<p>
<tt>zpool status</tt>
</p>

<p>
<tt>zfs list</tt>
</p>


                <h2>Conclusion<a name='Conclusion_1_9' class="offset-anchor"></a></h2>
              <p>
ZFS is an advanced powerful file system. With it's many advantages, I use this file to preserve data integrity and maintain my primary back-up. 
</p>

<p>
<a href="../../../Computing/Backup.html" title="More on backup" class="page">More on backup</a>
</p>


<p>
Copyrights:
</p>
<ul>
<li><a href="https://pixabay.com/vectors/hard-disk-technology-electronics-42935/" title="Hard drive image" class="https">Hard drive image</a></li>
<li><a href="https://ubuntu.com/wp-content/uploads/2569/openzfs.png" title="OpenZFS logo" class="https">OpenZFS logo</a></li>
</ul>

            
            <span class="backlinks">
                <hr class='footnotes'>
                <b>Backlinks:</b>
                <br />
                <a href='../../../Computing.html'>Computing</a>
                
<br />
                <a href='../../../Computing/Backup.html'>Computing:Backup</a>
                
<br />
                <a href='../../Index.html'>Journal:Index</a>
                
<br />
                <a href='../01.html'>Journal:2023:01</a>
                
            </span>

            

        </main>
      </div>
    </div>
  </body>
</html>
